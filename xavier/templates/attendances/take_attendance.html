{% extends "attendances/base.html" %}

{% block extrahead %}
<script type="text/javascript">
  function toggleAttendance(student_id) {
    var data = "student=" + student_id;
    $.ajax({
      url: "{% url 'attendances_attendancebook_take_attendance' classroom.id %}",
      method: "GET",
      data: data,
      cache: false
    });
    return false;
  }

  $(document).ready(function () {
    $('.switch').on('switch-change', function(e, data) {
      // TODO: switch only if success!
      var $el = $(data.el),
          value = data.value,
          student_id = $el[0].value;
      toggleAttendance(student_id);
    });
  });
</script>
{% endblock %}

{% block breadcrumb %}{{ block.super }}
  <li>
    <a href="{% url 'attendances_attendancebook_list' %}">{% trans 'Attendance books' %}</a>
    <span class="divider">/</span>
  </li>
  <li class="active">{% trans 'Take attendance' %}</li>
{% endblock %}

{% block main %}
<table class="table table-striped">
  <caption><h3>{{ attendance_book.day }}</h3></caption>
  <tr>
    <th>#</th>
    <th>{% trans 'Student' %}</th>
    <th>{% trans 'Status' %}</th>
  </tr>
  {% for student in classroom.students.all %}
  <tr>
    <td>{{ student.id }}</td>
    <td>{{ student.get_full_name }}</td>
    <td>
      <div class="switch" data-on="success" data-off="danger"
           data-on-label="<i class='icon-ok icon-white'></i>"
           data-off-label="<i class='icon-remove'></i>">
        <input type="checkbox" value="{{ student.pk }}" />
      </div>
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
